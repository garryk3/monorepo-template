# Архитектура проекта

> Стиль - **модульный монолит** (сборка и развертывание происходит одним артефактом)

Проект представляет собой монорепозиторий, состоящий из:

* основных приложений в директории **/apps**
* вспомогательных в директории **/packages** , которые помогают разрабатывать и тестировать основные приложения, содержат общий для приложений функционал, конфигурационные файлы

Архитектура приложений подчиняется описанным ниже правилам:

> Код приложения содержится в директории {packages/apps}/{ПРОЕКТ}/**src**, снаружи могут располагаться вспомогательные инструменты для сборки приложения, конфигурационные файлы для линтера, тестов и тд, т.е. все, что не относится непосредственно к бизнес-логике приложения. Все описанное ниже относится именно к **директории src** .

## Разделение системы на слои

На верхнем уровне система состоит из следующих слоев:

- **application** (верхний слой, содержит необходимый функционал для запуска приложения)
- **infrastructure** (вертикальный слой, вспомогательные утилиты, сервисы и тд)
- **presentation** (нижний слой - ui)
  - **pages** (страницы - верхний слой внутри presentation)
  - **features** (средний слой, фичи, вынесенные из страниц и другие самодостаточные сущности)
  - **ui** (нижний слой, общие ui компоненты преимущественно без бизнес логики)

##### Направление зависимостей на верхнем уровне системы:

*application -> presentation*

*application -> infrastructure*

*presentation -> infrastructure*

То есть **application** может импортировать компоненты из нижнего слоя **presentation**, а **presentation** не может импортировать ничего из **application**.

При этом слой **infrastructure** является вспомогательным (вертикальным слоем) и импорт из него доступен на всех уровнях, но он не может ничего импортировать из других слоев и является полностью самодостаточным.

##### Направление зависимостей на уровне слоя presentation:

*pages -> features*

*pages -> ui*

*features -> ui*

слой **features** является открытым, поэтому слою **pages** допустимо испортировать компоненты напрямую из слоя **ui**.

##### Одноуровневый импорт внутри слоев

Импорт внутри слоев разрешен, за исключением слоев **features**, **pages** - каждый компонент этих слоев должен быть самодостаточным и не зависеть от других компонентов своего уровня, только от компонентов нижних слоев.

> Самым важным правилом является то, что слой не должен знать никаких слоев над ним. Это выражается направлением стрелок, и понимание этого является фундаментальным

### Слои

##### Application

Уровень приложения - это связующий код, который объединяет все приложение и содержит компоненты в верхней части дерева компонентов. Он определяет маршрутизацию и заполняет общий контекст (например, тему, магазин) для остальной части вашего приложения.

##### Infrastructure

Уровень инфраструктуры отвечает за предоставление различных абстракций, чтобы уменьшить связь других уровней с конкретной реализацией.

Модули инфраструктуры могут обеспечить дополнительный уровень между API, которые вы не контролируете, заключая их в API, которым вы управляете. Примерами являются инструменты A / B-тестирования, отчеты об ошибках, средства ведения журнала, инструменты аналитики и т. Д. Другие уровни могут импортировать эти модули вместо прямого взаимодействия с внешними службами. Это сделает их обновление или даже замену менее головной болью.

Уровень инфраструктуры не ограничивается внешними службами. Это отличное место для настройки вашего приложения. Определите тему для ваших стилизованных компонентов, добавьте промежуточное ПО в свой экземпляр клиента REST или GraphQL или зарегистрируйте ServiceWorker.

##### Presentaion/Pages

С помощью компонента страницы на уровне **presentation** вы можете объединить компоненты контейнера в одну страницу.

##### Presentaion/Features

Общедоступные компоненты на уровне **feature** являются компонентами контейнера. Компоненты контейнера являются основными строительными блоками всей страницы. Эти «общедоступные» компоненты - единственные модули, которые могут быть импортированы на уровне приложения.

**Feature** компоненты должны быть сфокусированными и не доходить до других **features**. Импорт кода из одного **feature** в другой не должен происходить.

Уровень **features** импортирует презентационные компоненты из уровня пользовательского интерфейса (ui).

##### Presentation/Ui

Уровень пользовательского интерфейса, также называемый уровнем представления или интерфейса, будет содержать все повторно используемые презентационные компоненты. Если вы знакомы с идеей [атомарного дизайна](https://bradfrost.com/blog/post/atomic-web-design/) , слой пользовательского интерфейса - это то место, куда вы помещаете атомы. Мы говорим о таких компонентах, как Button, Table, Input. Слой пользовательского интерфейса - это место, где вы размещаете компоненты своей системы дизайна.

Вы должны сделать эти компоненты простыми и удобными для повторного использования. Компоненты уровня пользовательского интерфейса должны быть независимыми от любых бизнес-требований, специфичных для любой конкретной страницы в вашем приложении. Вот почему они не должны делать никаких HTTP-вызовов и зависеть от контекста рендеринга.
